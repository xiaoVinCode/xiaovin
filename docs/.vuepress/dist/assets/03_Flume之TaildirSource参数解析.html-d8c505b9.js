import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{r as n,o as r,c as i,a as e,b as l,d,f as a}from"./app-242a2990.js";const o={},c=a('<h4 id="一、介绍" tabindex="-1"><a class="header-anchor" href="#一、介绍" aria-hidden="true">#</a> 一、介绍</h4><p>TaildirSource是一种常用的数据源类型，可以实时监控指定目录下新增或修改的文件，并将其发送到Flume的Channel中供后续处理或转发。</p><p>TaildirSource最大的优点在于兼容多种格式和编码的日志文件，非常适合用于实时采集和分析系统日志和应用日志等场景。</p><h4 id="二、特性" tabindex="-1"><a class="header-anchor" href="#二、特性" aria-hidden="true">#</a> 二、特性</h4><ul><li>实时监控指定目录下新增的文件</li><li>支持文件通配符配置（如 <code>*.log</code>）</li><li>支持对指定文件夹递归搜索</li><li>支持对文件进行正则匹配和过滤</li><li>支持多线程异步处理，提高并发性能</li><li>支持多种文件读取方式，包括 Tail、Exec、Polling</li></ul><h4 id="二、参数" tabindex="-1"><a class="header-anchor" href="#二、参数" aria-hidden="true">#</a> 二、参数</h4><p>为了帮助您更好地理解TaildirSource的特性和使用方法，下面对它的各个参数进行一一解析和介绍：</p><table><thead><tr><th>序号</th><th>参数</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>channels</td><td>-</td><td>该参数指定 TaildirSource 所连接的 Channel 名称，可以是单个 Channel 或多个 Channel 组成的列表。</td></tr><tr><td>2</td><td>type</td><td>org.apache.flume.source.taildir.TaildirSource</td><td>该参数指定 TaildirSource 的类型。</td></tr><tr><td>3</td><td>filegroups</td><td>-</td><td>该参数指定需要监控的文件路径和文件名格式，可以是单个文件或多个文件组成的列表。每个文件组都需要包含一个 dir 和一个 filePattern 参数，用于指定目录和文件名的正则表达式。</td></tr><tr><td>4</td><td>fileSuffix</td><td>空</td><td>文件的后缀名，为空表示所有类型文件都接收，支持多种类型的配置，如 <em>.log,</em>.txt。</td></tr><tr><td>5</td><td>recursiveDirectorySearch</td><td>false</td><td>是否递归搜索子目录，默认为 false。</td></tr><tr><td>6</td><td>deserializer</td><td>TaildirEventDeserializer</td><td>该参数指定文件中的数据格式和编码方式，例如 Avro、Protobuf、JSON 等。如果不指定，则默认使用 TaildirEventDeserializer，它支持处理文本日志。</td></tr><tr><td>7</td><td>batchSize</td><td>100</td><td>该参数指定从 TaildirSource 读取数据的批次大小，即一次读取的最大行数，默认值为 100。</td></tr><tr><td>8</td><td>maxBatchCount</td><td>-</td><td>控制从同一文件连续读取的行数。 如果数据来源是通过tail多个文件的方式，并且其中一个文件的写入速度很快，则它可能会阻止其他文件被处理，因为这个繁忙文件将被无休止地读取。 在这种情况下，可以调低此参数来避免被一直读取一个文件。</td></tr><tr><td>9</td><td>bufferMaxLineLength</td><td>5000</td><td>该参数指定每行日志数据的最大长度。如果一行数据超过了这个长度，将会被拆分成多个 Event 发送到 Channel。默认值为 5000。</td></tr><tr><td>10</td><td>deletePolicy</td><td>never</td><td>该参数指定 TaildirSource 处理完一个文件后是否删除该文件。可选值为 never、immediate 和 delay。never 表示永远不删除文件；immediate 表示立即删除文件；delay 表示在文件被处理 delaySeconds 秒后再删除。默认值为 never。</td></tr><tr><td>11</td><td>delayMillis</td><td>5000</td><td>该参数指定 TaildirSource 轮询文件的间隔时间，即检查是否有新文件需要读取的时间间隔。默认值为 5 秒。</td></tr><tr><td>12</td><td>fileHeader</td><td>true</td><td>该参数指定是否在 Event Header 中添加文件名等信息。默认值为 true。</td></tr><tr><td>13</td><td>fileHeaderKey</td><td>file</td><td>指定文件路径存储在 Event Header 中的 key 名称，默认为 &quot;file&quot;。</td></tr><tr><td>14</td><td>headersPrefix</td><td>空</td><td>该参数指定在 Event Header 中添加文件信息时的前缀。默认为空字符串。</td></tr><tr><td>15</td><td>positionFile</td><td>/var/lib/flume/taildir_position.json</td><td>该参数指定保存位置信息的文件路径。位置信息用于记录每个文件已经读取到的位置，避免重复读取或漏读。默认值为 &quot;/var/lib/flume/taildir_position.json&quot;。</td></tr><tr><td>16</td><td>idleTimeout</td><td>120</td><td>若一个文件在一段时间内没有新内容可读，则认为该文件已经读完，默认为 120 秒。当然也可以设置为 -1 表示永不超时（除非文件被删除）。</td></tr><tr><td>17</td><td>ignorePattern</td><td>-</td><td>该参数指定哪些文件名不应该被读取。可以使用正则表达式匹配文件名，例如 ^.*.gz$ 表示不读取后缀为 .gz 的文件。</td></tr><tr><td>18</td><td>addByteOffset</td><td>true</td><td>该参数指定是否在 Event Header 中添加字节偏移量信息，即当前行数据在文件中的起始位置。默认值为 true。</td></tr><tr><td>19</td><td>fileHeaderKey</td><td>file</td><td>指定文件路径存储在 Event Header 中的 key 名称，默认为 &quot;file&quot;。</td></tr></tbody></table>',8),u={href:"https://flume.liyifeng.org/#taildir-source",target:"_blank",rel:"noopener noreferrer"},p=a(`<figure><img src="https://static-resource-yang.oss-cn-shenzhen.aliyuncs.com/typora_pic/202304162122643.png" alt="image-20230409175720559" tabindex="0" loading="lazy"><figcaption>image-20230409175720559</figcaption></figure><h4 id="三、其它可选参数。" tabindex="-1"><a class="header-anchor" href="#三、其它可选参数。" aria-hidden="true">#</a> 三、其它可选参数。</h4><h5 id="_1-文件打开方式相关参数" tabindex="-1"><a class="header-anchor" href="#_1-文件打开方式相关参数" aria-hidden="true">#</a> 1. 文件打开方式相关参数</h5><ul><li><code>fileHeaderKey</code>：指定文件路径存储在 Event Header 中的 key 名称，默认为 &quot;file&quot;</li><li><code>startFromEnd</code>：是否从文件末尾开始读取，默认为 false，表示从文件头部开始读取</li><li><code>positionFile</code>: 存储文件读取位置信息的文件路径，默认值是 <code>\${sys:flume.conf.dir}/taildir_positions.json</code>。</li><li><code>preserveExisting</code>：当一个文件重启后是否保持之前的 Offset 位置。如果设为 false，则从 Taildir Source 启动后，该 Source 只会处理新增的文件，而已经存在的文件将被忽略。默认为 true。</li></ul><h5 id="_2-目录扫描方式相关参数" tabindex="-1"><a class="header-anchor" href="#_2-目录扫描方式相关参数" aria-hidden="true">#</a> 2. 目录扫描方式相关参数</h5><ul><li><code>recursiveDirectorySearch</code>：是否递归搜索子目录，默认为 false</li><li><code>fileGroups</code>：定义多个目录或者多个目录下的文件。例如，可以配置多个 directory，每个directory都可以包含多个 filegroup，每个filegroup可以定义多个目录或者多个目录下的文件。示例：<code>agent.sources.taildir-source.filegroups.f1 = /var/log/f1/*.log,/var/log/f1*.log, /var/log/f2/</code>。</li><li><code>groupMapping</code>：定义文件名与 group（即 fileGroup）的映射关系。示例：<code>agent.sources.taildir-source.groupMapping.Washington = f1,f2,f3; agent.sources.taildir-source.groupMapping.Hamilton = f3</code>。</li></ul><h5 id="_3-文件过滤和重命名参数" tabindex="-1"><a class="header-anchor" href="#_3-文件过滤和重命名参数" aria-hidden="true">#</a> 3. 文件过滤和重命名参数</h5><ul><li><code>filters</code>：定义使用哪些 Filter 对文件进行过滤。如果该参数未设置，则默认为“不进行过滤”。</li><li><code>filter.&lt;filter-name&gt;.type</code>：定义要使用的 Filter 的类型，其中 filter-name 表示 Filter 的名称。</li><li><code>filter.&lt;filter-name&gt;.&lt;filter-specific-parameter&gt;</code>：以 filter-specific-parameter 为参数配置 Filter 的具体参数（如 regex）。</li></ul><h5 id="_4-多线程异步处理参数" tabindex="-1"><a class="header-anchor" href="#_4-多线程异步处理参数" aria-hidden="true">#</a> 4. 多线程异步处理参数</h5><ul><li><code>deserializer.maxLineLength</code>：设置解析每行数据的最大长度，默认为 2048 字节。</li><li><code>numWorkerThreads</code>：用于读取文件的线程数，默认为 1。</li><li><code>batchSize</code>：每次读取的数据批次大小，默认为 1000。</li><li><code>decompressBufferMaxLen</code>：解压缩数据的最大长度，默认为 10 MB。</li></ul><h4 id="四、配置示例" tabindex="-1"><a class="header-anchor" href="#四、配置示例" aria-hidden="true">#</a> 四、配置示例</h4><p>该例子监控 <code>/var/log</code> 目录下所有以 <code>.log</code> 后缀的文件，并将其发送到 channel。</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">复制代码agent.sources.taildir-source.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">channel-1</span>
<span class="token key attr-name">agent.sources.taildir-source.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.flume.source.taildir.TaildirSource</span>
<span class="token key attr-name">agent.sources.taildir-source.positionFile</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/tmp/taildir_positions.json</span>
<span class="token key attr-name">agent.sources.taildir-source.fileHeader</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">agent.sources.taildir-source.basenameHeader</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">agent.sources.taildir-source.fileSuffix</span> <span class="token punctuation">=</span> <span class="token value attr-value">.log</span>
<span class="token key attr-name">agent.sources.taildir-source.recursiveDirectorySearch</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">agent.sources.taildir-source.batchSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000</span>
<span class="token key attr-name">agent.sources.taildir-source.idleTimeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">120</span>
<span class="token key attr-name">agent.sources.taildir-source.ignorePattern</span> <span class="token punctuation">=</span> <span class="token value attr-value">^(.)*\\.(gz|bz2)$</span>
<span class="token key attr-name">agent.sources.taildir-source.deletePolicy</span> <span class="token punctuation">=</span> <span class="token value attr-value">immediate</span>
<span class="token key attr-name">agent.sources.taildir-source.headerTable.file</span> <span class="token punctuation">=</span> <span class="token value attr-value">headers.filepath</span>
<span class="token key attr-name">agent.sources.taildir-source.headerTable.size</span> <span class="token punctuation">=</span> <span class="token value attr-value">headers.filesize</span>
<span class="token key attr-name">agent.sources.taildir-source.headerTable.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">headers.filetype</span>
<span class="token key attr-name">agent.sources.taildir-source.fileHeaderKey</span> <span class="token punctuation">=</span> <span class="token value attr-value">file</span>
<span class="token key attr-name">agent.sources.taildir-source.startFromEnd</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">agent.sources.taildir-source.fileGroups</span> <span class="token punctuation">=</span> <span class="token value attr-value">f1</span>
<span class="token key attr-name">agent.sources.taildir-source.filegroups.f1</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的是，如果 <code>startFromEnd</code> 参数设置为 true，则在配置文件中指定的 <code>positionFile</code> 应该存储最后一行已经读取的位置信息。</p><h4 id="五、实操" tabindex="-1"><a class="header-anchor" href="#五、实操" aria-hidden="true">#</a> 五、实操</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">agent1.sources.tail_source.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">TAILDIR</span>
<span class="token key attr-name">agent1.sources.tail_source.positionFile</span> <span class="token punctuation">=</span> <span class="token value attr-value">\${exec_log_path}/position.json</span>
<span class="token key attr-name">agent1.sources.tail_source.filegroups</span> <span class="token punctuation">=</span> <span class="token value attr-value">f1 f2</span>
<span class="token key attr-name">agent1.sources.tail_source.filegroups.f1</span> <span class="token punctuation">=</span> <span class="token value attr-value">/data/gather_service/logs/stat_info/collect-info.log</span>
<span class="token key attr-name">agent1.sources.tail_source.filegroups.f2</span> <span class="token punctuation">=</span> <span class="token value attr-value">/data/gather_service/logs/stat_info/collect-info.log.*[^g][^z]$</span>
<span class="token key attr-name">agent1.sources.tail_source.maxBatchCount</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000</span>
<span class="token key attr-name">agent1.sources.tail_source.selector.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">replicating</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16);function v(h,f){const t=n("ExternalLinkIcon");return r(),i("div",null,[c,e("p",null,[e("a",u,[l("Flume 1.9用户手册中文版"),d(t)])]),p])}const g=s(o,[["render",v],["__file","03_Flume之TaildirSource参数解析.html.vue"]]);export{g as default};
